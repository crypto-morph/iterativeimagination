# LLM Prompts for Iterative Imagination
# Edit these prompts to adjust how the AI analyzes and evaluates images
# Use {placeholders} for dynamic content that will be filled in by the code

ask_question: |
  Answer this question about the image: {question}
  
  Question type: {type_info}{enum_info}{min_max_info}
  
  Provide your answer in JSON format matching the question type:
  {{
      "answer": <your_answer_here>
  }}
  
  For boolean questions, use true/false.
  For number/integer questions, provide a numeric value.
  For string questions, provide a text description.
  For array questions, provide a JSON array.

ask_multiple_questions: |
  Answer ALL of the following questions about the image. Answer each question carefully based on the image content.
  
  {questions_list}
  
  {original_image_context}
  
  Provide your answers in JSON format with one field per question:
  {{
      "<field1>": <answer1>,
      "<field2>": <answer2>,
      ...
  }}
  
  For boolean questions, use true/false.
  For number/integer questions, provide a numeric value within the specified range.
  For string questions, provide a text description.
  For array questions, provide a JSON array.
  
  Ensure all answers match their specified types and constraints.

evaluate_acceptance_criteria: |
  Evaluate this GENERATED image against acceptance criteria, comparing it to the ORIGINAL image.
  
  ORIGINAL IMAGE DESCRIPTION:
  {original_description}
  
  QUESTION ANSWERS (for context):
  {questions_summary}
  
  ACCEPTANCE CRITERIA:
  {criteria_text}
  
  For each criterion, determine if it passes (true/false or within min/max range).
  Then calculate overall score: (passed_criteria / total_criteria) * 100
  
  Provide your evaluation in JSON format:
  {{
      "overall_score": <0-100>,
      "criteria_results": {{
          "<field1>": <true/false or value>,
          "<field2>": <true/false or value>,
          ...
      }}
  }}

compare_images: |
  Compare these two images and analyze the differences.
  
  Focus on:
  1. Similarity score (0.0 = completely different, 1.0 = identical)
  2. What differences exist? (clothing, pose, features, background, proportions)
  3. Overall analysis
  
  Provide your comparison in JSON format:
  {{
      "similarity_score": <0.0-1.0>,
      "differences": ["difference1", "difference2", ...],
      "analysis": "detailed analysis text"
  }}

describe_image: |
  Describe this image in detail. Focus on:
  1. Main subject (person, object, scene)
  2. If person: appearance, pose, clothing
  3. Background/setting
  4. Overall composition and notable details
  
  Provide a detailed description.

improve_prompts: |
  You are helping improve image generation prompts for Stable Diffusion.
  
  Current positive prompt: {current_positive}
  Current negative prompt: {current_negative}
  
  Evaluation results:
  - Overall score: {overall_score}%
  - Failed criteria: {failed_criteria}
  
  Image comparison:
  - Similarity: {similarity_score}
  - Differences: {differences}
  - Analysis: {analysis}
  
  Rules to achieve:
  {rules_text}
  
  Important constraints:
  1. The rules are authoritative. Optimise the prompts to satisfy the failed criteria first.
  2. Use the tags provided in the rules:
     - Ensure all must_include terms appear in the positive prompt.
     - Ensure all ban_terms appear in the negative prompt.
     - Do NOT put must_include terms (or obvious variants/plurals) into the negative prompt.
     - Do NOT put ban_terms (or obvious variants/plurals) into the positive prompt.
  3. Preserve identity, pose, background, and body proportions when asked, by describing them explicitly in the positive prompt.
  4. Output prompts as short, comma-separated tags/phrases only. Do NOT output full sentences, and do NOT use negations like "no X" or "not X" (negations belong in the negative prompt as plain terms).

  Suggest improved positive and negative prompts that:
  1. Address the failed criteria
  2. Maintain what's working well
  3. Better achieve the rules
  4. Follow Stable Diffusion prompt best practices
  
  Provide your suggestions in JSON format:
  {{
      "positive": "<improved positive prompt>",
      "negative": "<improved negative prompt>"
  }}

generate_base_prompts: |
  You are generating a CLEAN starting positive and negative prompt for Stable Diffusion img2img/inpainting.
  
  Context:
  - ORIGINAL IMAGE DESCRIPTION (what we are starting from):
    {original_description}
  - SCOPE:
    {scope}
  
  ACTIVE CRITERIA (authoritative):
  {active_criteria_text}
  
  Rules:
  - The positive prompt MUST include all must_include terms from the active criteria (or obvious close variants).
  - The negative prompt MUST include all ban_terms from the active criteria (or obvious close variants).
  - Avoid putting must_include terms into the negative prompt.
  - Avoid putting ban_terms into the positive prompt.
  - If criteria ask to preserve identity/pose/background/body proportions, explicitly include those preserve tags in the positive prompt.
  - IMPORTANT: Prompt order matters in Stable Diffusion. Put the PRIMARY CHANGE (must_include terms from "change" intent criteria) at the FRONT of the positive prompt for maximum weight.
  - Then add scene/setting context, then preservation terms (identical features, same pose, etc.).
  - Output short comma-separated tags/phrases only. No full sentences. No "no X"/"not X" phrases.
  
  Output JSON ONLY:
  {{
      "positive": "<comma-separated tags>",
      "negative": "<comma-separated tags>"
  }}

suggest_rules_tags: |
  You are a YAML configuration reviewer. Your job is to improve the data-driven tags for each acceptance criterion in a rules.yaml file.
  
  Guidelines:
  {guidelines}
  
  Here is the current rules.yaml:
  ```yaml
  {rules_yaml}
  ```
  
  Focus ONLY on `acceptance_criteria` entries. Do NOT change:
  - project name or max_iterations
  - criteria field names
  - criteria questions
  - criteria type/min/max (unless they are clearly invalid; if so, put it in notes only)
  - the `questions:` section
  
  For each acceptance criterion, ensure these keys exist and are appropriate:
  - intent: "change" or "preserve"
  - edit_strength: "low" | "medium" | "high"
  - must_include: list of short prompt phrases that help satisfy the criterion
  - ban_terms: list of terms that must not appear in the generated result (or that should be strongly discouraged via negative prompt)
  - avoid_terms: list of terms to discourage (softer than ban_terms)
  
  Output JSON ONLY in the following structure:
  {{
    "acceptance_criteria": [
      {{
        "field": "<field>",
        "intent": "change|preserve",
        "edit_strength": "low|medium|high",
        "must_include": ["..."],
        "ban_terms": ["..."],
        "avoid_terms": ["..."],
        "notes": "short rationale / caveats"
      }}
    ],
    "general_notes": ["..."]
  }}
